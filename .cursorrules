# Pravidla projektu: Prague Student Housing (Migration to Django)

Jsi expertní Python a Django vývojář. Tvým hlavním cílem je pomoci s migrací scraperu z JSON/Flask do robustní Django architektury běžící v Dockeru.

## Technický Stack
- **Django:** 5.0.1
- **Python:** 3.12-slim
- **PostgreSQL:** 15-alpine
- **Tailwind CSS:** v4.1.18 (standalone CLI binary)
- **Web scraping:** requests 2.31.0, beautifulsoup4 4.12.3
- **WSGI Server:** gunicorn 21.2.0

## Klíčová Architektura
- **Kontejnerizace:** Projekt běží ve třech Docker kontejnerech:
  - `db` (service name) / `najmovac_db` (container): PostgreSQL 15-alpine na portu 5432
  - `backend` (service name) / `najmovac_backend` (container): Django webserver na portu 8000
  - `scraper` (service name) / `najmovac_scraper` (container): Scraper běžící jako Django management command
- **Shared Image:** Kontejnery `backend` a `scraper` používají stejný Docker image (./backend/Dockerfile), liší se pouze spouštěcím příkazem.
- **Zápis dat:** Scraper MUSÍ běžet jako **Django Management Command** (`python manage.py run_scraper`).
- **ORM:** Pro veškerou komunikaci s databází používej výhradně Django ORM. Nikdy nepiš raw SQL.
- **Environment:** Veškerá konfigurace v `.env` souboru (DB credentials, Django secret key, allowed hosts).

## Docker Networking
- Service names = hostnames: `db`, `backend`, `scraper`
- Container names jsou jen labely: `najmovac_db`, `najmovac_backend`, `najmovac_scraper`
- `POSTGRES_HOST` v `.env` MUSÍ být `db` (service name, ne container name)
- Internal ports: PostgreSQL 5432, Django 8000
- External ports: PostgreSQL 5432:5432, Django 8000:8000

## Frontend (Tailwind CSS v4)
- **Build proces:** Standalone Tailwind CLI binary (`./tailwindcss`)
- **Command:** `./tailwindcss -i backend/static/css/input.css -o backend/static/css/style.css --watch`
- **V4 Breaking Changes:** NEPOUŽÍVEJ `@apply` directive - Tailwind v4 má jiný syntax
  - Místo `@tailwind base; @tailwind components; @tailwind utilities;` používej `@import "tailwindcss";`
  - Custom CSS musí používat klasické CSS hodnoty, ne Tailwind utilities přes @apply
- **Config:** tailwind.config.js sleduje `./templates/**/*.html` a `./apartments/static/**/*.js`
- **Styling:** Maximálně utility-first přístup, custom CSS pouze pro věci co Tailwind neumí (Leaflet overrides, animace, scrollbary)

## Pravidla pro Scraper (Priorita: Anti-Blocking)
- **Hlavičky:** Vždy používej realistické `User-Agent` hlavičky (simuluj moderní prohlížeče).
- **Prodlevy:** Mezi jednotlivými požadavky (requesty) vkládej náhodné prodlevy (`time.sleep`) pomocí knihovny `random`.
- **Inkrementální stahování:** Před stažením detailu bytu vždy zkontroluj v DB, zda už existuje dvojice `source` + `remote_id`. Pokud ano, přeskoč ho.
- **Logování:** Každý úspěšný i neúspěšný scrape vypiš do konzole pomocí `self.stdout.write()`.

## Databázový Model (models.py)
- Model `Apartment` musí být minimalistický pro start:
    - `source` (Char): 'sreality' nebo 'bezrealitky'.
    - `remote_id` (Char): Unikátní ID z daného webu.
    - `title`, `price`, `address`, `url`, `description`, `image_url`.
    - `created_at` (DateTimeField): auto_now_add=True.
- Unikátnost: `unique_together = ('source', 'remote_id')`.

## Co teď NEŘEŠIT (Mimo rozsah session)
- Ignoruj body zájmu (MHD, posilovny, parky).
- Ignoruj pokročilou monetizaci (Stripe atd.).
- Jediný povolený prvek monetizace je odkaz na **Buy Me a Coffee**.
- Nepoužívej JS frameworky (React), stačí čisté **Django Templates**.

## Coding Style
- Anglické názvy proměnných, české komentáře v kódu.
- Vždy při změně modelů připomeň spuštění `python manage.py makemigrations` a `python manage.py migrate`.

## Common Docker Commands
- Start: `docker compose up -d`
- Stop: `docker compose down`
- Rebuild: `docker compose up -d --build`
- Exec into backend: `docker compose exec backend python manage.py [command]`
- Logs: `docker compose logs -f [service_name]`
- Create superuser: `docker compose exec backend python manage.py createsuperuser`